# AUTO-GENERATED BY CHEF - DO NOT MODIFY

topology "<%= node['chef-server']['topology'] %>"

<% unless node['chef-server']['api_fqdn'].nil? || node['chef-server']['api_fqdn'].empty? -%>
api_fqdn "<%= node['chef-server']['api_fqdn'] %>"
<% end -%>

<% node['chef-server']['configuration'].each_pair do |component, tunables| -%>
<% case tunables -%>
<% when Hash -%>
<% tunables.each_pair do |name, value| -%>
<% value = %Q["#{value}"] if value.kind_of?(String) -%>
<%= "#{component.gsub("-","_")}['#{name}'] = #{value}" %>
<% end -%>
<% when String -%>
<%= component.gsub('-', '_') %> "<%= tunables %>"
<% end -%>
<% end -%>

<% @chef_servers.each do |server| -%>
server '<%= server[:fqdn] %>',
  :ipaddress => '<%= server[:ipaddress] %>',
  <% if server[:bootstrap] -%>
  :bootstrap => true,
  <% end -%>
  :role => '<%= server[:role] %>'
<%   if server[:role] == 'backend' -%>
backend_vip '<%= server[:fqdn] %>',
  :ipaddress => '<%= server[:ipaddress] %>'
<% end -%>
<% end -%>
